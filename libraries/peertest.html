<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <h1>NovaOS Sendit</h1>
    <h2>Compatible with WebDrop</h2><br>
    My Name: <input type="text" id="name"><br>
    File Name: <input type="text" id="fname"><br>
    File Content: <input type="text" id="fcontent"><br>
    Recepient's ID: <input type="text" id="recepient"><br>
    <button id="send">Send It!</button><br>
    Log Goes Here: <br>
    <textarea readonly id="log" cols="30" rows="10"></textarea>
    <script src="peer.js"></script>
    <script>
        var els = {
            me: {
                id: document.querySelector("#myID"),
                name: document.querySelector("#name")
            },
            file: {
                name: document.querySelector("#fname"),
                cunt: document.querySelector("#fcontent")
            },
            recepient: document.querySelector("#recepient"),
            btn: document.querySelector("#send"),
            log: document.querySelector("#log")
        }
        var fucker = gen(4);
        peer = new Peer(fucker)
        async function getId() {
            setInterval(function () {
                if (typeof (installID) === 'undefined') {
                    console.log('<!> DeskID failed to register, trying again...');
                } else {
                    alert("Succ-cess")
                }
            }, 10000);
        }

        function gen(length) {
            if (length <= 0) {
                console.error('Length should be greater than 0');
                return null;
            }

            const min = Math.pow(10, length - 1);
            const max = Math.pow(10, length) - 1;
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        peer.on('open', (peerId) => {
            var installID = peerId
            els.log.value = els.log.value + "Grabbed ID Successfully! " + peerId + "\n"
        });
        peer.on('connection', (conn) => {
            console.log("A wild connection has appeared")
            conn.on('data', (data) => {
                if (data.name === "MigrationPackDeskFuck") {
                    els.log.value = els.log.value + "Sorry, NovaOS does not support WebDesk Migration.\n"
                } else if (data.name === "YesImAlive-WebKey") {
                    els.log.value = els.log.value + "File sent successfully!\n"
                } else if (data.name === "DesktoDeskMsg-WebKey") {
                    els.log.value = els.log.value + `Message from WebDesk: ${data.file}\n`
                } else {
                    var conn = peer.connect(data.id);
                    // on open will be launch when you successfully connect to PeerServer
                    conn.on('open', function () {
                        // here you have conn.id
                        conn.send({ name: "YesImAlive-WebKey" });
                    });
                }
            });
        });
        els.btn.onclick = function () {
            var data = {
                name: els.file.name.value,
                file: els.file.cunt.value,
                uname: els.me.name.value,
                id: fucker
            };
            var conn = peer.connect(els.recepient.value);
            // on open will be launch when you successfully connect to PeerServer
            conn.on('open', function () {
                // here you have conn.id
                conn.send(data);
            });
        }
    </script>
</body>

</html>